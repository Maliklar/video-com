(function(t){function e(e){for(var n,c,r=e[0],i=e[1],l=e[2],u=0,h=[];u<r.length;u++)c=r[u],Object.prototype.hasOwnProperty.call(s,c)&&s[c]&&h.push(s[c][0]),s[c]=0;for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n]);d&&d(e);while(h.length)h.shift()();return a.push.apply(a,l||[]),o()}function o(){for(var t,e=0;e<a.length;e++){for(var o=a[e],n=!0,r=1;r<o.length;r++){var i=o[r];0!==s[i]&&(n=!1)}n&&(a.splice(e--,1),t=c(c.s=o[0]))}return t}var n={},s={app:0},a=[];function c(e){if(n[e])return n[e].exports;var o=n[e]={i:e,l:!1,exports:{}};return t[e].call(o.exports,o,o.exports,c),o.l=!0,o.exports}c.m=t,c.c=n,c.d=function(t,e,o){c.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},c.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},c.t=function(t,e){if(1&e&&(t=c(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(c.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)c.d(o,n,function(e){return t[e]}.bind(null,n));return o},c.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return c.d(e,"a",e),e},c.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},c.p="/";var r=window["webpackJsonp"]=window["webpackJsonp"]||[],i=r.push.bind(r);r.push=e,r=r.slice();for(var l=0;l<r.length;l++)e(r[l]);var d=i;a.push([0,"chunk-vendors"]),o()})({0:function(t,e,o){t.exports=o("56d7")},"0670":function(t,e,o){"use strict";o("1f42")},"099c":function(t,e,o){"use strict";o("2cad")},"13d4":function(t,e,o){t.exports=o.p+"img/end-call.9383a37e.png"},"1f42":function(t,e,o){},"2cad":function(t,e,o){},"2f4d":function(t,e,o){},3886:function(t,e,o){t.exports=o.p+"img/next-call.5a736e9d.png"},"56d7":function(t,e,o){"use strict";o.r(e);var n=o("7a23");const s=Object(n["e"])("h1",{class:"call-state",id:"call-state"},null,-1);function a(t,e,o,a,c,r){const i=Object(n["j"])("remote-video"),l=Object(n["j"])("LocalVideo"),d=Object(n["j"])("Loading"),u=Object(n["j"])("ControlesContainer");return Object(n["h"])(),Object(n["d"])("main",null,[Object(n["f"])(i),Object(n["f"])(l,{onClick:r.dele},null,8,["onClick"]),"calling"==t.$store.state.callState?(Object(n["h"])(),Object(n["b"])(d,{key:0})):Object(n["c"])("",!0),s,Object(n["f"])(u)])}const c={class:"controles-container"};function r(t,e,o,s,a,r){const i=Object(n["j"])("call-button"),l=Object(n["j"])("mute-button"),d=Object(n["j"])("end-call-button"),u=Object(n["j"])("next-button");return Object(n["h"])(),Object(n["d"])("div",c,["idle"==t.$store.state.callState?(Object(n["h"])(),Object(n["b"])(i,{key:0,class:"call-button"})):Object(n["c"])("",!0),"connected"==t.$store.state.callState?(Object(n["h"])(),Object(n["b"])(l,{key:1,class:"mute-button"})):Object(n["c"])("",!0),"calling"==t.$store.state.callState||"connected"==t.$store.state.callState?(Object(n["h"])(),Object(n["b"])(d,{key:2,class:"end-call-button"})):Object(n["c"])("",!0),"connected"==t.$store.state.callState?(Object(n["h"])(),Object(n["b"])(u,{key:3,class:"next-button"})):Object(n["c"])("",!0)])}var i=o("df74"),l=o.n(i);function d(t,e,o,s,a,c){return Object(n["h"])(),Object(n["d"])("img",{src:l.a,onClick:e[0]||(e[0]=t=>c.connect()),id:"call-icon",alt:"Call Icon"})}var u={methods:{async connect(){this.$store.state.callState="calling";const t=this.$store.state.query(this.$store.state.collection(this.$store.state.db,"Queue"),this.$store.state.where("userId","!=",this.$store.state.userId),this.$store.state.where("type","==","offer"),this.$store.state.where("active","==",!0)),e=await this.$store.state.getDocs(t);if(console.log(e),e.empty)this.$store.state.peerConnection.createOffer().then(t=>this.$store.state.peerConnection.setLocalDescription(t)).then(async()=>{try{const t=await this.$store.state.addDoc(this.$store.state.collection(this.$store.state.db,"Queue"),{userId:this.$store.state.userId,sdp:JSON.stringify(this.$store.state.peerConnection.localDescription),active:!0,type:"offer"});console.log("Document written with ID: ",t.id),this.$store.state.documentId=t.id,this.userDocument=t.id}catch(t){console.error("Error adding document: ",t)}this.$store.state.onSnapshot(this.$store.state.doc(this.$store.state.db,"Queue",this.userDocument),t=>{const e=t.metadata.hasPendingWrites?"Local":"Server";if(console.log(e," data: ",t.data()),"answer"==t.data().type){const e=JSON.parse(t.data().sdp);this.$store.state.peerConnection.setRemoteDescription(e)}})}).then(()=>console.log("then"));else{const t=Math.floor(Math.random()*e.docs.length),o=e.docs[t].data();this.$store.state.documentId=e.docs[t].id;const n=JSON.parse(o.sdp);this.$store.state.peerConnection.setRemoteDescription(n),this.$store.state.peerConnection.createAnswer().then(t=>this.$store.state.peerConnection.setLocalDescription(t)).then(async()=>{setTimeout(()=>{this.$store.state.updateDoc(this.$store.state.doc(this.$store.state.db,"Queue",this.$store.state.documentId),{sdp:JSON.stringify(this.$store.state.peerConnection.localDescription),type:"answer",active:!1})},5e3)})}}}},h=o("6b0d"),b=o.n(h);const p=b()(u,[["render",d]]);var f=p,$=o("13d4"),O=o.n($);function j(t,e,o,s,a,c){return Object(n["h"])(),Object(n["d"])("img",{src:O.a,onClick:e[0]||(e[0]=t=>c.endCall()),alt:"End Call Icon"})}var m={methods:{endCall(){this.resetConnection(),this.$store.state.updateDoc(this.$store.state.doc(this.$store.state.db,"Queue",this.$store.state.documentId),{active:!1}),this.$store.state.callState="idle"}}};const v=b()(m,[["render",j]]);var g=v,C=o("d50d"),y=o.n(C);const D={src:y.a,alt:"Mute Icon"};function w(t,e,o,s,a,c){return Object(n["h"])(),Object(n["d"])("img",D)}var I={};const S=b()(I,[["render",w]]);var x=S,k=o("3886"),E=o.n(k);const N={src:E.a,alt:"Next Call Icon"};function M(t,e,o,s,a,c){return Object(n["h"])(),Object(n["d"])("img",N)}var P={};const V=b()(P,[["render",M]]);var L=V,Q={components:{CallButton:f,EndCallButton:g,MuteButton:x,NextButton:L}};o("099c");const B=b()(Q,[["render",r]]);var R=B;const T={class:"video-container",id:"local-video-container"},_=Object(n["e"])("video",{id:"local-video",autoplay:""},null,-1),J=[_];function q(t,e,o,s,a,c){return Object(n["h"])(),Object(n["d"])("div",T,J)}var A={};o("7f9a");const U=b()(A,[["render",q]]);var F=U;const z={id:"remote-video-container"},G=Object(n["e"])("video",{id:"remote-video",src:"",autoplay:""},null,-1),H=[G];function K(t,e,o,s,a,c){return Object(n["h"])(),Object(n["d"])("div",z,H)}var W={};o("e435");const Y=b()(W,[["render",K]]);var X=Y,Z=o("9359"),tt=o.n(Z);const et={class:"loading",src:tt.a,alt:"Loading"};function ot(t,e,o,s,a,c){return Object(n["h"])(),Object(n["d"])("img",et)}var nt={};o("0670");const st=b()(nt,[["render",ot]]);var at=st,ct={components:{ControlesContainer:R,Loading:at,LocalVideo:F,RemoteVideo:X},name:"App",async created(){window.addEventListener("beforeunload",async t=>{t.preventDefault(),t.returnValue="";const e=this.$store.state.query(this.$store.state.collection(this.$store.state.db,"Queue"),this.$store.state.where("userId","==",this.$store.state.userId)),o=await this.$store.state.getDocs(e);o.forEach(t=>{console.log(t),this.$store.state.deleteDoc(this.$store.state.doc(this.$store.state.db,"Queue",t.id))})})},data(){return{userDocument:null}},methods:{async dele(){const t=this.$store.state.query(this.$store.state.collection(this.$store.state.db,"Queue"),this.$store.state.where("userId","==",this.$store.state.userId)),e=await this.$store.state.getDocs(t);e.forEach(t=>{console.log(t),this.$store.state.deleteDoc(this.$store.state.doc(this.$store.state.db,"Queue",t.id))})}},async mounted(){this.$store.state.localVideo=document.getElementById("local-video"),this.$store.state.remoteVideo=document.getElementById("remote-video"),navigator.mediaDevices.getUserMedia({video:!0}).then(t=>{this.$store.state.localVideo.srcObject=t,this.$store.state.localVideo.play(),this.$store.state.peerConnection.addStream(t)})}};o("c85c");const rt=b()(ct,[["render",a]]);var it=rt,lt=o("5502"),dt=o("4b38"),ut=o("10b8"),ht=o("ec26");const bt={apiKey:"AIzaSyAyHRr_nc-i78jM0wkYpppw-3_xiID3yEs",authDomain:"video-call-website-3b63b.firebaseapp.com",projectId:"video-call-website-3b63b",storageBucket:"video-call-website-3b63b.appspot.com",messagingSenderId:"2143810265",appId:"1:2143810265:web:e4a464d955b1d4cea184c8",measurementId:"G-E7NRCTMBDF"},pt=Object(dt["a"])(bt),ft=Object(ut["g"])(pt);var $t=Object(lt["a"])({state(){return{collection:ut["b"],db:ft,addDoc:ut["a"],doc:ut["d"],getDoc:ut["e"],where:ut["l"],getDocs:ut["f"],query:ut["i"],onSnapshot:ut["h"],deleteDoc:ut["c"],setDoc:ut["j"],updateDoc:ut["k"],localVideo:null,remoteVideo:null,userId:Object(ht["a"])(),documentId:"",peerConnection:new RTCPeerConnection,dataChannel:null,callState:"idle"}},mutations:{},actions:{},modules:{}}),Ot={data(){return{}},methods:{resetConnection(){this.$store.state.peerConnection.close(),this.$store.state.peerConnection=new RTCPeerConnection,navigator.mediaDevices.getUserMedia({video:!0}).then(t=>{this.$store.state.peerConnection.addStream(t)}),this.$store.state.dataChannel=this.$store.state.peerConnection.createDataChannel("Data Channel")}},created(){this.$store.state.dataChannel=this.$store.state.peerConnection.createDataChannel("Data Channel"),this.$store.state.dataChannel.onmessage=t=>{console.log("Message Received: "+t.data)},this.$store.state.dataChannel.onopen=()=>{this.$store.state.callState="connected",console.log("CONNECTION OPENED")},this.$store.state.dataChannel.onclose=()=>{this.$store.state.callState="idle",this.resetConnection(),console.log("CONNECTION Closed")},this.$store.state.peerConnection.onicecandidate=()=>{console.log("ICE FOUND: ")},this.$store.state.peerConnection.ontrack=t=>{console.log("----------------track received"),this.$store.state.remoteVideo.srcObject=t.streams[0]}}};Object(n["a"])(it).use($t).mixin(Ot).mount("#app")},7073:function(t,e,o){},"7f9a":function(t,e,o){"use strict";o("c7ed")},9359:function(t,e,o){t.exports=o.p+"img/Infinity-1s-200px.8b829e01.svg"},c7ed:function(t,e,o){},c85c:function(t,e,o){"use strict";o("2f4d")},d50d:function(t,e,o){t.exports=o.p+"img/mute.02453d3d.png"},df74:function(t,e,o){t.exports=o.p+"img/call.d7bfe510.png"},e435:function(t,e,o){"use strict";o("7073")}});
//# sourceMappingURL=app.d9738864.js.map